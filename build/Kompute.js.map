{"version":3,"file":"Kompute.js","sources":["../js/core/Vector3D.js","../js/core/VectorPool.js","../js/core/Box.js","../js/third-party/Nearby.js","../js/core/World.js","../js/core/Entity.js","../js/steering/Steerable.js","../js/steering/SteerResult.js","../js/steering/behavior/SteeringBehavior.js","../js/steering/behavior/SeekBehavior.js","../js/debug/DebugHelper.js"],"sourcesContent":["var Vector3D = function(x, y, z){\n  this.x = x || 0;\n  this.y = y || 0;\n  this.z = z || 0;\n}\n\nVector3D.prototype.set = function(x, y, z){\n  this.x = x;\n  this.y = y;\n  this.z = z;\n  return this;\n}\n\nVector3D.prototype.copy = function(vect){\n  return this.set(vect.x, vect.y, vect.z);\n}\n\nVector3D.prototype.clone = function(){\n  return (new Vector3D()).copy(this);\n}\n\nVector3D.prototype.multiplyScalar = function(scalar){\n  this.set(this.x * scalar, this.y * scalar, this.z * scalar);\n  return this;\n}\n\nVector3D.prototype.min = function(vect){\n  this.x = Math.min(this.x, vect.x);\n  this.y = Math.min(this.y, vect.y);\n  this.z = Math.min(this.z, vect.z);\n\n  return this;\n}\n\nVector3D.prototype.max = function(vect){\n  this.x = Math.max(this.x, vect.x);\n  this.y = Math.max(this.y, vect.y);\n  this.z = Math.max(this.z, vect.z);\n\n  return this;\n}\n\nVector3D.prototype.getLength = function(){\n  return Math.sqrt((this.x * this.x) + (this.y * this.y) + (this.z * this.z));\n}\n\nVector3D.prototype.add = function(vect){\n  this.x += vect.x;\n  this.y += vect.y;\n  this.z += vect.z;\n\n  return this;\n}\n\nVector3D.prototype.sub = function(vect){\n  this.x -= vect.x;\n  this.y -= vect.y;\n  this.z -= vect.z;\n\n  return this;\n}\n\nVector3D.prototype.normalize = function(){\n  var len = this.getLength();\n  this.x = this.x / len;\n  this.y = this.y / len;\n  this.z = this.z / len;\n\n  return this;\n}\n\nexport { Vector3D };\n","import { Vector3D } from \"./Vector3D\";\n\nvar VectorPool = function(size){\n  this.index = 0;\n\n  this.vectors = [];\n  for (var i = 0; i < size; i ++){\n    this.vectors.push(new Vector3D());\n  }\n}\n\nVectorPool.prototype.get = function(){\n  var vect = this.vectors[this.index ++];\n  if (this.index == this.vectors.length){\n    this.index = 0;\n  }\n  return vect;\n}\n\nexport { VectorPool };\n","import { Vector3D } from \"./Vector3D\";\nimport { VectorPool } from \"./VectorPool\";\n\nvar vectorPool = new VectorPool(10);\n\nvar Box = function(centerPosition, size){\n  this.min = new Vector3D();\n  this.max = new Vector3D();\n\n  this.setFromCenterAndSize(centerPosition, size);\n}\n\n\nBox.prototype.setFromCenterAndSize = function(center, size){\n  var half = vectorPool.get().copy(size).multiplyScalar(0.5);\n  this.min.set(center.x - half.x, center.y - half.y, center.z - half.z);\n  this.max.set(center.x + half.x, center.y + half.y, center.z + half.z);\n  return this;\n}\n\nBox.prototype.makeEmpty = function(){\n  this.min.set(Infinity, Infinity, Infinity);\n  this.max.set(Infinity, Infinity, Infinity);\n  return this;\n}\n\nBox.prototype.expandByPoint = function(point){\n  this.min.min(point);\n  this.max.max(point);\n\n  return this;\n}\n\nBox.prototype.intersectsBox = function(box){\n  return !(box.max.x < this.min.x || box.min.x > this.max.x ||\n            box.max.y < this.min.y || box.min.y > this.max.y ||\n              box.max.z < this.min.z || box.min.z > this.max.z);\n}\n\nexport { Box };\n","var Nearby = function Nearby(width, height, depth, binSize) {\n  this.limitBox = this.createBox(0, 0, 0, width, height, depth);\n  this.binSize = binSize;\n\n  this.bin = new Map();\n\n  this.reusableResultMap = new Map();\n};\n\nNearby.prototype.createBox = function (x, y, z, width, height, depth) {\n  var bb = {};\n\n  bb.containsBox = function (box) {\n    return this.minX <= box.minX && box.maxX <= this.maxX && this.minY <= box.minY && box.maxY <= this.maxY && this.minZ <= box.minZ && box.maxZ <= this.maxZ;\n  };\n\n  bb.setFromCenterAndSize = function (x, y, z, width, height, depth) {\n    var halfWidth = width / 2;\n    var halfHeight = height / 2;\n    var halfDepth = depth / 2;\n\n    this.minX = x - halfWidth;\n    this.maxX = x + halfWidth;\n    this.minY = y - halfHeight;\n    this.maxY = y + halfHeight;\n    this.minZ = z - halfDepth;\n    this.maxZ = z + halfDepth;\n  };\n\n  bb.setFromCenterAndSize(x, y, z, width, height, depth);\n\n  return bb;\n};\n\nNearby.prototype.createObject = function (id, box) {\n  var self = this;\n\n  var obj = {\n    id: id,\n    box: box,\n    binInfo: new Map()\n  };\n\n  return obj;\n};\n\nNearby.prototype.insert = function (obj) {\n  if (!this.limitBox.containsBox(obj.box)) {\n    return;\n  }\n\n  var BIN_SIZE = this.binSize;\n\n  var box = obj.box;\n  var minX = box.minX;\n  var minY = box.minY;\n  var minZ = box.minZ;\n  var maxX = box.maxX;\n  var maxY = box.maxY;\n  var maxZ = box.maxZ;\n\n  var round = Math.round(minX / BIN_SIZE) * BIN_SIZE;\n  var minXLower, minXUpper;\n  if (round <= minX) {\n    minXLower = round;\n    minXUpper = minXLower + BIN_SIZE;\n  } else {\n    minXUpper = round;\n    minXLower = round - BIN_SIZE;\n  }\n\n  round = Math.round(maxX / BIN_SIZE) * BIN_SIZE;\n  var maxXLower, maxXUpper;\n  if (round < maxX) {\n    maxXLower = round;\n    maxXUpper = maxXLower + BIN_SIZE;\n  } else {\n    maxXUpper = round;\n    maxXLower = round - BIN_SIZE;\n  }\n  if (minXLower > maxXLower) {\n    maxXLower = minXLower;\n  }\n\n  round = Math.round(minY / BIN_SIZE) * BIN_SIZE;\n  var minYLower, minYUpper;\n  if (round <= minY) {\n    minYLower = round;\n    minYUpper = minYLower + BIN_SIZE;\n  } else {\n    minYUpper = round;\n    minYLower = round - BIN_SIZE;\n  }\n\n  round = Math.round(maxY / BIN_SIZE) * BIN_SIZE;\n  var maxYLower, maxYUpper;\n  if (round < maxY) {\n    maxYLower = round;\n    maxYUpper = maxYLower + BIN_SIZE;\n  } else {\n    maxYUpper = round;\n    maxYLower = round - BIN_SIZE;\n  }\n  if (minYLower > maxYLower) {\n    maxYLower = minYLower;\n  }\n\n  round = Math.round(minZ / BIN_SIZE) * BIN_SIZE;\n  var minZLower, minZUpper;\n  if (round <= minZ) {\n    minZLower = round;\n    minZUpper = minZLower + BIN_SIZE;\n  } else {\n    minZUpper = round;\n    minZLower = round - BIN_SIZE;\n  }\n\n  round = Math.round(maxZ / BIN_SIZE) * BIN_SIZE;\n  var maxZLower, maxZUpper;\n  if (round < maxZ) {\n    maxZLower = round;\n    maxZUpper = maxZLower + BIN_SIZE;\n  } else {\n    maxZUpper = round;\n    maxZLower = round - BIN_SIZE;\n  }\n  if (minZLower > maxZLower) {\n    maxZLower = minZLower;\n  }\n\n  for (var x = minXLower; x <= maxXLower; x += BIN_SIZE) {\n    for (var y = minYLower; y <= maxYLower; y += BIN_SIZE) {\n      for (var z = minZLower; z <= maxZLower; z += BIN_SIZE) {\n        if (!this.bin.has(x)) {\n          this.bin.set(x, new Map());\n        }\n        if (!this.bin.get(x).has(y)) {\n          this.bin.get(x).set(y, new Map());\n        }\n        if (!this.bin.get(x).get(y).has(z)) {\n          this.bin.get(x).get(y).set(z, new Map());\n        }\n        this.bin.get(x).get(y).get(z).set(obj, true);\n\n        if (!obj.binInfo.has(x)) {\n          obj.binInfo.set(x, new Map());\n        }\n        if (!obj.binInfo.get(x).has(y)) {\n          obj.binInfo.get(x).set(y, new Map());\n        }\n        obj.binInfo.get(x).get(y).set(z, true);\n      }\n    }\n  }\n};\n\nNearby.prototype.query = function (x, y, z) {\n  var BIN_SIZE = this.binSize;\n\n  var rX = Math.round(x / BIN_SIZE) * BIN_SIZE;\n  var rY = Math.round(y / BIN_SIZE) * BIN_SIZE;\n  var rZ = Math.round(z / BIN_SIZE) * BIN_SIZE;\n\n  var minX, maxX;\n  if (rX <= x) {\n    minX = rX;\n    maxX = rX + BIN_SIZE;\n  } else {\n    maxX = rX;\n    minX = rX - BIN_SIZE;\n  }\n  var minY, maxY;\n  if (rY <= y) {\n    minY = rY;\n    maxY = rY + BIN_SIZE;\n  } else {\n    maxY = rY;\n    minY = rY - BIN_SIZE;\n  }\n  var minZ, maxZ;\n  if (rZ <= z) {\n    minZ = rZ;\n    maxZ = rZ + BIN_SIZE;\n  } else {\n    maxZ = rZ;\n    minZ = rZ - BIN_SIZE;\n  }\n\n  var result = this.reusableResultMap;\n  result.clear();\n\n  for (var xDiff = -BIN_SIZE; xDiff <= BIN_SIZE; xDiff += BIN_SIZE) {\n    for (var yDiff = -BIN_SIZE; yDiff <= BIN_SIZE; yDiff += BIN_SIZE) {\n      for (var zDiff = -BIN_SIZE; zDiff <= BIN_SIZE; zDiff += BIN_SIZE) {\n        var keyX = minX + xDiff;\n        var keyY = minY + yDiff;\n        var keyZ = minZ + zDiff;\n        if (this.bin.has(keyX) && this.bin.get(keyX).has(keyY)) {\n          var res = this.bin.get(keyX).get(keyY).get(keyZ);\n          if (res) {\n            var _iteratorNormalCompletion = true;\n            var _didIteratorError = false;\n            var _iteratorError = undefined;\n\n            try {\n              for (var _iterator = res.keys()[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                var obj = _step.value;\n\n                result.set(obj, true);\n              }\n            } catch (err) {\n              _didIteratorError = true;\n              _iteratorError = err;\n            } finally {\n              try {\n                if (!_iteratorNormalCompletion && _iterator.return) {\n                  _iterator.return();\n                }\n              } finally {\n                if (_didIteratorError) {\n                  throw _iteratorError;\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return result;\n};\n\nNearby.prototype.delete = function (obj) {\n  var binInfo = obj.binInfo;\n\n  var _iteratorNormalCompletion2 = true;\n  var _didIteratorError2 = false;\n  var _iteratorError2 = undefined;\n\n  try {\n    for (var _iterator2 = binInfo.keys()[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n      var x = _step2.value;\n      var _iteratorNormalCompletion4 = true;\n      var _didIteratorError4 = false;\n      var _iteratorError4 = undefined;\n\n      try {\n        for (var _iterator4 = binInfo.get(x).keys()[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n          var y = _step4.value;\n          var _iteratorNormalCompletion5 = true;\n          var _didIteratorError5 = false;\n          var _iteratorError5 = undefined;\n\n          try {\n            for (var _iterator5 = binInfo.get(x).get(y).keys()[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n              var z = _step5.value;\n\n              if (this.bin.has(x) && this.bin.get(x).has(y) && this.bin.get(x).get(y).has(z)) {\n                this.bin.get(x).get(y).get(z).delete(obj);\n                if (this.bin.get(x).get(y).get(z).size == 0) {\n                  this.bin.get(x).get(y).delete(z);\n                }\n                if (this.bin.get(x).get(y).size == 0) {\n                  this.bin.get(x).delete(y);\n                }\n                if (this.bin.get(x).size == 0) {\n                  this.bin.delete(x);\n                }\n              }\n            }\n          } catch (err) {\n            _didIteratorError5 = true;\n            _iteratorError5 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion5 && _iterator5.return) {\n                _iterator5.return();\n              }\n            } finally {\n              if (_didIteratorError5) {\n                throw _iteratorError5;\n              }\n            }\n          }\n        }\n      } catch (err) {\n        _didIteratorError4 = true;\n        _iteratorError4 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion4 && _iterator4.return) {\n            _iterator4.return();\n          }\n        } finally {\n          if (_didIteratorError4) {\n            throw _iteratorError4;\n          }\n        }\n      }\n    }\n  } catch (err) {\n    _didIteratorError2 = true;\n    _iteratorError2 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion2 && _iterator2.return) {\n        _iterator2.return();\n      }\n    } finally {\n      if (_didIteratorError2) {\n        throw _iteratorError2;\n      }\n    }\n  }\n\n  var _iteratorNormalCompletion3 = true;\n  var _didIteratorError3 = false;\n  var _iteratorError3 = undefined;\n\n  try {\n    for (var _iterator3 = binInfo.keys()[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n      var x = _step3.value;\n\n      binInfo.delete(x);\n    }\n  } catch (err) {\n    _didIteratorError3 = true;\n    _iteratorError3 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion3 && _iterator3.return) {\n        _iterator3.return();\n      }\n    } finally {\n      if (_didIteratorError3) {\n        throw _iteratorError3;\n      }\n    }\n  }\n};\n\nNearby.prototype.update = function (obj, x, y, z, width, height, depth) {\n  obj.box.setFromCenterAndSize(x, y, z, width, height, depth);\n\n  this.delete(obj);\n  this.insert(obj);\n};\n\nexport default Nearby;\n","import Nearby from \"../third-party/Nearby\";\n\nvar World = function(width, height, depth, binSize){\n  this.nearby = new Nearby(width, height, depth, binSize);\n\n  this.entititesByID = {};\n}\n\nWorld.prototype.getEntityByID = function(entityID){\n  return this.entititesByID[entityID] || null;\n}\n\nWorld.prototype.insertEntity = function(entity){\n\n  this.entititesByID[entity.id] = entity;\n\n  var center = entity.position;\n  var size = entity.size;\n\n  var nearbyBox = this.nearby.createBox(center.x, center.y, center.z, size.x, size.y, size.z);\n  var nearbyObj = this.nearby.createObject(entity.id, nearbyBox);\n  this.nearby.insert(nearbyObj);\n\n  entity.world = this;\n  entity.nearbyObject = nearbyObj;\n\n  if (this.onEntityInserted){\n    this.onEntityInserted(entity);\n  }\n}\n\nWorld.prototype.updateEntity = function(entity, position, size){\n  this.nearby.update(entity.nearbyObject, position.x, position.y, position.z, size.x, size.y, size.z);\n\n  if (this.onEntityUpdated){\n    this.onEntityUpdated(entity);\n  }\n}\n\nWorld.prototype.removeEntity = function(entity){\n  delete this.entititesByID[entity.id];\n  this.nearby.delete(entity.nearbyObject);\n\n  if (this.onEntityRemoved){\n    this.onEntityRemoved(entity);\n  }\n}\n\nWorld.prototype.getNearbyObjects = function(position){\n  return this.nearby.query(position.x, position.y, position.z).keys();\n}\n\nWorld.prototype.forEachEntity = function(func){\n  for (var key in this.entititesByID){\n    var entity = this.entititesByID[key];\n    func(entity);\n  }\n}\n\nexport { World };\n","import { Box } from \"./Box\";\nimport { Vector3D } from \"./Vector3D\";\nimport { VectorPool } from \"./VectorPool\";\n\nvar delta = 1/60;\nvar vectorPool = new VectorPool(10);\n\nvar Entity = function(id, center, size){\n  this.id = id;\n  this.size = size;\n  this.position = center.clone();\n\n  this.world = null;\n\n  this.box = new Box(center, size);\n\n  this.nearbyObject = null;\n\n  this.maxSpeed = Infinity;\n  this.velocity = new Vector3D();\n}\n\nEntity.prototype.update = function(){\n  var speed = this.velocity.getLength();\n  if (speed > this.maxSpeed){\n    this.velocity.copy(this.velocity.normalize().multiplyScalar(this.maxSpeed));\n  }\n\n  var vect = vectorPool.get().copy(this.velocity).multiplyScalar(delta);\n  this.setPosition(this.position.add(vect));\n}\n\nEntity.prototype.setPosition = function(position){\n  this.position.copy(position);\n  this.box.setFromCenterAndSize(position, this.size);\n\n  if (this.world){\n    this.world.updateEntity(this, this.position, this.size);\n  }\n}\n\nEntity.prototype.executeForEachCloseEntity = function(func){\n  if (!this.world){\n    return;\n  }\n  var res = this.world.getNearbyObjects(this.position);\n  for (var obj of res){\n    if (obj.id != this.id){\n      func(this.world.getEntityByID(obj.id));\n    }\n  }\n}\n\nexport { Entity };\n","import { Entity } from \"../core/Entity\";\nimport { Vector3D } from \"../core/Vector3D\";\nimport { VectorPool } from \"../core/VectorPool\";\n\nvar delta = 1/60;\nvar vectorPool = new VectorPool(10);\n\nvar Steerable = function(id, center, size){\n  Entity.call(this, id, center, size);\n\n  this.hasTargetPosition = false;\n  this.targetPosition = new Vector3D();\n\n  this.linearAcceleration = new Vector3D();\n  this.maxAcceleration = Infinity;\n}\n\nSteerable.prototype = Object.create(Entity.prototype);\n\nSteerable.prototype.update = function(){\n  if (!this.world || !this.behavior){\n    return;\n  }\n\n  var steerResult = this.behavior.compute();\n  if (!steerResult){\n    return;\n  }\n\n  this.linearAcceleration.copy(steerResult.linear);\n\n  var len = this.linearAcceleration.getLength();\n  if (len > this.maxAcceleration){\n    this.linearAcceleration.copy(this.linearAcceleration.normalize().multiplyScalar(this.maxAcceleration));\n  }\n\n  var vect = vectorPool.get().copy(this.linearAcceleration).multiplyScalar(delta);\n  this.velocity.add(vect);\n  Entity.prototype.update.call(this);\n}\n\nSteerable.prototype.setBehavior = function(behaviorConstructor){\n  var behavior = new behaviorConstructor(this);\n  this.behavior = behavior;\n}\n\nSteerable.prototype.setTargetPosition = function(x, y, z){\n  this.targetPosition.set(x, y, z);\n  this.hasTargetPosition = true;\n}\n\nObject.defineProperty(Steerable.prototype, 'constructor', { value: Steerable,  enumerable: false, writable: true });\nexport { Steerable };\n","import { Vector3D } from \"../core/Vector3D\";\n\nvar SteerResult = function(){\n  this.linear = new Vector3D();\n}\n\nexport { SteerResult };\n","import { SteerResult } from \"../SteerResult\";\n\nvar SteeringBehavior = function(steerable){\n  this.steerable = steerable;\n  this.result = new SteerResult();\n}\n\nSteeringBehavior.prototype.compute = function(){\n  return null;\n}\n\nexport { SteeringBehavior }\n","import { SteeringBehavior } from \"./SteeringBehavior\";\n\nvar SeekBehavior = function(steerable){\n  SteeringBehavior.call(this, steerable);\n}\n\nSeekBehavior.prototype = Object.create(SteeringBehavior.prototype);\n\nSeekBehavior.prototype.compute = function(){\n\n  var steerable = this.steerable;\n  if (!steerable.hasTargetPosition){\n    return null;\n  }\n\n  this.result.linear.copy(steerable.targetPosition).sub(steerable.position).normalize().multiplyScalar(steerable.maxAcceleration);\n  return this.result;\n}\n\nObject.defineProperty(SeekBehavior.prototype, 'constructor', { value: SeekBehavior,  enumerable: false, writable: true });\nexport { SeekBehavior };\n","var DebugHelper = function(world, threeInstance, scene){\n  this.world = world;\n  this.threeInstance = threeInstance;\n  this.scene = scene;\n\n  this.isActive = false;\n\n  this.threeMaterial = new threeInstance.MeshBasicMaterial({ color: \"lime\", wireframe: true });\n\n  this.meshesByEntityID = {};\n\n  this.world.onEntityInserted = function(entity){\n    if (!this.isActive){\n      return;\n    }\n    this.addEntity(entity);\n  }.bind(this);\n\n  this.world.onEntityRemoved = function(entity){\n    if (!this.isActive){\n      return;\n    }\n    var mesh = this.meshesByEntityID[entity.id];\n    this.scene.remove(mesh);\n    delete this.meshesByEntityID[entity.id];\n  }.bind(this);\n\n  this.world.onEntityUpdated = function(entity){\n    if (!this.isActive){\n      return;\n    }\n    var mesh = this.meshesByEntityID[entity.id];\n    mesh.position.set(entity.position.x, entity.position.y, entity.position.z);\n  }.bind(this);\n}\n\nDebugHelper.prototype.addEntity = function(entity){\n  var mesh = this.createMeshFromEntity(entity);\n  this.meshesByEntityID[entity.id] = mesh;\n  this.scene.add(mesh);\n}\n\nDebugHelper.prototype.activate = function(){\n  this.isActive = true;\n\n  this.world.forEachEntity(function(entity){\n    this.addEntity(entity);\n  }.bind(this));\n}\n\nDebugHelper.prototype.deactivate = function(){\n  this.isActive = false;\n\n  for (var entityID in this.meshesByEntityID){\n    this.scene.remove(this.meshesByEntityID[entityID]);\n  }\n\n  this.meshesByEntityID = {};\n}\n\nDebugHelper.prototype.createMeshFromEntity = function(entity){\n  var boxGeometry = new this.threeInstance.BoxBufferGeometry(entity.size.x, entity.size.y, entity.size.z);\n  var mesh = new this.threeInstance.Mesh(boxGeometry, this.threeMaterial);\n  mesh.position.set(entity.position.x, entity.position.y, entity.position.z);\n\n  return mesh;\n}\n\nexport { DebugHelper };\n"],"names":["Vector3D","x","y","z","prototype","set","copy","vect","clone","multiplyScalar","scalar","min","Math","max","getLength","sqrt","add","sub","normalize","len","VectorPool","size","index","vectors","i","push","get","length","vectorPool","Box","centerPosition","setFromCenterAndSize","center","half","makeEmpty","Infinity","expandByPoint","point","intersectsBox","box","Nearby","width","height","depth","binSize","limitBox","createBox","bin","Map","reusableResultMap","bb","containsBox","minX","maxX","minY","maxY","minZ","maxZ","halfWidth","halfHeight","halfDepth","createObject","id","self","obj","insert","BIN_SIZE","round","minXLower","minXUpper","maxXLower","maxXUpper","minYLower","minYUpper","maxYLower","maxYUpper","minZLower","minZUpper","maxZLower","maxZUpper","has","binInfo","query","rX","rY","rZ","result","clear","xDiff","yDiff","zDiff","keyX","keyY","keyZ","res","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","keys","Symbol","iterator","_step","next","done","value","err","return","delete","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_iterator4","_step4","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_iterator5","_step5","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_iterator3","_step3","update","World","nearby","entititesByID","getEntityByID","entityID","insertEntity","entity","position","nearbyBox","nearbyObj","world","nearbyObject","onEntityInserted","updateEntity","onEntityUpdated","removeEntity","onEntityRemoved","getNearbyObjects","forEachEntity","func","key","delta","Entity","maxSpeed","velocity","speed","setPosition","executeForEachCloseEntity","Steerable","call","hasTargetPosition","targetPosition","linearAcceleration","maxAcceleration","Object","create","behavior","steerResult","compute","linear","setBehavior","behaviorConstructor","setTargetPosition","defineProperty","enumerable","writable","SteerResult","SteeringBehavior","steerable","SeekBehavior","DebugHelper","threeInstance","scene","isActive","threeMaterial","MeshBasicMaterial","color","wireframe","meshesByEntityID","addEntity","bind","mesh","remove","createMeshFromEntity","activate","deactivate","boxGeometry","BoxBufferGeometry","Mesh"],"mappings":"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"}