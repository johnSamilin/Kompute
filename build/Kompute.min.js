(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.Kompute=a.Kompute||{})})(this,function(a){'use strict';var b=Math.round,c=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0};c.prototype.set=function(a,b,c){return this.x=a,this.y=b,this.z=c,this},c.prototype.copy=function(a){return this.set(a.x,a.y,a.z)},c.prototype.clone=function(){return new c().copy(this)},c.prototype.multiplyScalar=function(a){return this.set(this.x*a,this.y*a,this.z*a),this};var d=function(a){this.index=0,this.vectors=[];for(var b=0;b<a;b++)this.vectors.push(new c)};d.prototype.get=function(){var a=this.vectors[this.index++];return this.index==this.vectors.length&&(this.index=0),a};var e=new d(10),f=function(a,b){this.min=new c,this.max=new c,this.setFromCenterAndSize(a,b)};f.prototype.setFromCenterAndSize=function(a,b){var c=e.get().copy(b).multiplyScalar(.5);return this.min.set(a.x-c.x,a.y-c.y,a.z-c.z),this.max.set(a.x+c.x,a.y+c.y,a.z+c.z),this};var g=function(a,b,c,d){this.limitBox=this.createBox(0,0,0,a,b,c),this.binSize=d,this.bin=new Map,this.reusableResultMap=new Map};g.prototype.createBox=function(a,b,c,d,e,f){var g={};return g.containsBox=function(a){return this.minX<=a.minX&&a.maxX<=this.maxX&&this.minY<=a.minY&&a.maxY<=this.maxY&&this.minZ<=a.minZ&&a.maxZ<=this.maxZ},g.setFromCenterAndSize=function(a,b,c,d,e,f){var g=d/2,h=e/2,i=f/2;this.minX=a-g,this.maxX=a+g,this.minY=b-h,this.maxY=b+h,this.minZ=c-i,this.maxZ=c+i},g.setFromCenterAndSize(a,b,c,d,e,f),g},g.prototype.createObject=function(a,b){var c=this,d={id:a,box:b,binInfo:new Map};return d},g.prototype.insert=function(a){if(this.limitBox.containsBox(a.box)){var c,d,e=this.binSize,f=a.box,g=f.minX,h=f.minY,i=f.minZ,j=f.maxX,k=f.maxY,l=f.maxZ,m=b(g/e)*e;m<=g?(c=m,d=c+e):(d=m,c=m-e),m=b(j/e)*e;var n,o;m<j?(n=m,o=n+e):(o=m,n=m-e),c>n&&(n=c),m=b(h/e)*e;var p,q;m<=h?(p=m,q=p+e):(q=m,p=m-e),m=b(k/e)*e;var r,s;m<k?(r=m,s=r+e):(s=m,r=m-e),p>r&&(r=p),m=b(i/e)*e;var t,u;m<=i?(t=m,u=t+e):(u=m,t=m-e),m=b(l/e)*e;var v,w;m<l?(v=m,w=v+e):(w=m,v=m-e),t>v&&(v=t);for(var A=c;A<=n;A+=e)for(var B=p;B<=r;B+=e)for(var C=t;C<=v;C+=e)this.bin.has(A)||this.bin.set(A,new Map),this.bin.get(A).has(B)||this.bin.get(A).set(B,new Map),this.bin.get(A).get(B).has(C)||this.bin.get(A).get(B).set(C,new Map),this.bin.get(A).get(B).get(C).set(a,!0),a.binInfo.has(A)||a.binInfo.set(A,new Map),a.binInfo.get(A).has(B)||a.binInfo.get(A).set(B,new Map),a.binInfo.get(A).get(B).set(C,!0)}},g.prototype.query=function(a,c,d){var e,f,g=this.binSize,h=b(a/g)*g,i=b(c/g)*g,j=b(d/g)*g;h<=a?(e=h,f=h+g):(f=h,e=h-g);var k,l;i<=c?(k=i,l=i+g):(l=i,k=i-g);var m,n;j<=d?(m=j,n=j+g):(n=j,m=j-g);var o=this.reusableResultMap;o.clear();for(var p=-g;p<=g;p+=g)for(var q=-g;q<=g;q+=g)for(var r=-g;r<=g;r+=g){var s=e+p,t=k+q,u=m+r;if(this.bin.has(s)&&this.bin.get(s).has(t)){var v=this.bin.get(s).get(t).get(u);if(v){var w=!0,x=!1,y=void 0;try{for(var z,A,B=v.keys()[Symbol.iterator]();!(w=(z=B.next()).done);w=!0)A=z.value,o.set(A,!0)}catch(a){x=!0,y=a}finally{try{!w&&B.return&&B.return()}finally{if(x)throw y}}}}}return o},g.prototype.delete=function(a){var b=a.binInfo,c=!0,d=!1,e=void 0;try{for(var f,g=b.keys()[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value,i=!0,j=!1,k=void 0;try{for(var l,m=b.get(h).keys()[Symbol.iterator]();!(i=(l=m.next()).done);i=!0){var n=l.value,o=!0,p=!1,q=void 0;try{for(var r,s,t=b.get(h).get(n).keys()[Symbol.iterator]();!(o=(r=t.next()).done);o=!0)s=r.value,this.bin.has(h)&&this.bin.get(h).has(n)&&this.bin.get(h).get(n).has(s)&&(this.bin.get(h).get(n).get(s).delete(a),0==this.bin.get(h).get(n).get(s).size&&this.bin.get(h).get(n).delete(s),0==this.bin.get(h).get(n).size&&this.bin.get(h).delete(n),0==this.bin.get(h).size&&this.bin.delete(h))}catch(a){p=!0,q=a}finally{try{!o&&t.return&&t.return()}finally{if(p)throw q}}}}catch(a){j=!0,k=a}finally{try{!i&&m.return&&m.return()}finally{if(j)throw k}}}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}var u=!0,v=!1,w=void 0;try{for(var y,h,A=b.keys()[Symbol.iterator]();!(u=(y=A.next()).done);u=!0)h=y.value,b.delete(h)}catch(a){v=!0,w=a}finally{try{!u&&A.return&&A.return()}finally{if(v)throw w}}},g.prototype.update=function(a,b,c,d,e,f,g){a.box.setFromCenterAndSize(b,c,d,e,f,g),this.delete(a),this.insert(a)};var h=function(a,b,c,d){this.nearby=new g(a,b,c,d),this.entititesByID={}};h.prototype.insertEntity=function(a){this.entititesByID[a.id]=a;var b=a.center,c=a.size,d=this.nearby.createBox(b.x,b.y,b.z,c.x,c.y,c.z),e=this.nearby.createObject(a.id,d);this.nearby.insert(e),a.assignNearbyObject(e)};var i=function(a,b,c){this.id=a,this.center=b,this.size=c,this.nearbyObject=null,this.position=this.center.clone()};i.prototype.assignNearbyObject=function(a){this.nearbyObject=a},a.Vector3D=c,a.VectorPool=d,a.Box=f,a.World=h,a.Entity=i,Object.defineProperty(a,"__esModule",{value:!0})});